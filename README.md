# AltimeterAvia

Мобильное приложение для iOS: барометрический высотомер с индикатором вертикальной скорости (VSI). Данные берутся **только с барометра iPhone** (не GPS).

## Возможности

- **ALT** — текущая высота над уровнем моря (м), по барометрической формуле от давления и QNH
- **VSI** — скорость набора/снижения высоты (м/с)
- **Нулевая высота** — кнопка фиксирует текущую точку как ноль; далее отсчёт идёт относительно неё
- **QNH** — настраиваемое давление на уровне моря (по умолчанию 1013.25 hPa) для пересчёта давления в высоту
- **GPS (опционально)** — второстепенные данные: количество спутников (на iOS в API недоступно, показывается «—»), скорость (м/с), высота по GPS (м). Блок можно включить/выключить и свернуть
- **Запись треков** — сохранение маршрута (высота, координаты, время) с просмотром на карте и в 3D, статистика
- **Локализация** — интерфейс на русском и английском (en/ru)

## Требования

- iOS 15.0+
- Устройство с барометром (iPhone 6 и новее)

## Сборка и запуск

### Запуск в симуляторе (скрипт)

**Требования:** установленный Xcode и активная папка разработчика:

```bash
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
```

**Запуск** (из корня репозитория):

```bash
./run-simulator.sh
```

Скрипт соберёт проект, при необходимости запустит симулятор, установит и откроет приложение. По умолчанию используется симулятор **iPhone 17 Pro**.

**Другой симулятор** — список устройств: `xcrun simctl list devices available`. Пример:

```bash
DESTINATION='platform=iOS Simulator,name=iPhone 16' ./run-simulator.sh
```

**Переменные:** `SCHEME` (схема Xcode, по умолчанию `AltimeterAvia`), `DESTINATION` (симулятор).

В симуляторе **нет барометра** — высота и VSI будут нулевыми; полная работа только на реальном iPhone.

### Установка на подключённый iPhone (по кабелю)

Подключите iPhone кабелем, при запросе на телефоне нажмите «Доверять этому компьютеру». В Xcode один раз настройте **Signing & Capabilities** (ваша команда/сертификат) для таргета AltimeterAvia.

Из корня репозитория:

```bash
./deploy-to-phone.sh
```

Скрипт находит первое подключённое устройство (iPhone/iPad), собирает приложение под него и устанавливает (через devicectl в Xcode 15+ или ios-deploy при установке: `brew install ios-deploy`).

### Запуск из Xcode

1. Откройте `AltimeterAvia.xcodeproj` в Xcode.
2. Выберите целевое устройство или симулятор вверху (барометр есть только на устройстве).
3. Нажмите **Run** (▶️) или **⌘R**.

При первом запуске на устройстве система запросит доступ к данным о движении (барометр) и, при включённом GPS, к геолокации.

## Структура проекта

- `AltimeterAviaApp.swift` — точка входа приложения
- `ContentView.swift` — главный экран с приборами и кнопками «Нулевая высота» / «QNH»
- `RootView.swift` — корневая навигация (главный экран / список треков)
- `BarometerManager.swift` — работа с `CMAltimeter`, расчёт высоты по давлению и VSI
- `LocationManager.swift` — GPS для опционального блока и записи треков
- `TrackStore.swift` — сохранение и загрузка треков (SQLite)
- `L10n.swift` — ключи локализации
- `Views/AltimeterGaugeView.swift` — круговой индикатор высоты и QNH
- `Views/VSIGaugeView.swift` — круговой индикатор вертикальной скорости
- `Views/AltitudeDisplayView.swift` — отображение ALT
- `Views/GPSInfoView.swift` — блок GPS (спутники, скорость, высота по GPS)
- `Views/TracksView.swift` — список сохранённых треков
- `Views/TrackDetailView.swift` — детали трека, карта, 3D, статистика
- `Views/TrackMapView.swift`, `Views/Track3DView.swift`, `Views/TrackStatsView.swift`
- `Views/RecordingOptionsSheet.swift` — опции перед началом записи
- `en.lproj/`, `ru.lproj/` — строки локализации (Localizable.strings, InfoPlist.strings)
- `Info.plist` — описание доступа к данным движения (барометр) и геолокации

## Технические детали

- Высота вычисляется по барометрической формуле от текущего давления и QNH.
- «Нулевая высота» сохраняется в UserDefaults и вычитается из отображаемой высоты.
- VSI считается по изменению высоты за последние ~2 с и слегка сглаживается.
- Треки хранятся локально в SQLite; точки содержат время, широту, долготу, высоту (барометрическую).